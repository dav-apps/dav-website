<mat-sidenav-container>
	<mat-sidenav #sideNav [mode]="sideNavHidden ? 'over' : 'side'" [(opened)]="sideNavOpened">
		<mat-nav-list style="margin-top: 100px">
			<mat-list-item (click)="ShowGeneralMenu()" disableRipple [ngClass]="selectedMenu == 0 ? 'selected-menu-item' : ''" class="px-4">{{ locale.sideNav.general }}</mat-list-item>
			<mat-list-item (click)="ShowPlansMenu()" disableRipple [ngClass]="selectedMenu == 1 ? 'selected-menu-item' : ''" class="px-4">{{ locale.sideNav.plans }}</mat-list-item>
			<mat-list-item (click)="ShowAppsMenu()" disableRipple [ngClass]="selectedMenu == 2 ? 'selected-menu-item' : ''" class="px-4">{{ locale.sideNav.apps }}</mat-list-item>
			<mat-list-item (click)="ShowProviderMenu()" disableRipple [ngClass]="selectedMenu == 3 ? 'selected-menu-item' : ''" class="px-4">{{ locale.sideNav.provider }}</mat-list-item>
		</mat-nav-list>
	</mat-sidenav>
  	<mat-sidenav-content style="overflow: hidden">
		<!-- SideNav toggle button -->
		<button 
			class="btn btn-sm ml-2 icon-button"
			style="margin-top: 84px; height: 40px; width: 40px; font-size: 18px; position: absolute; z-index: 1"
			(click)="sideNavOpened = !sideNavOpened"
			*ngIf="sideNavHidden">
			<fab-icon iconName="More"></fab-icon>
		</button>

		<!-- General settings -->
		<div class="navbar-margin pt-4 ms-motion-slideUpIn" style="background-color: white" *ngIf="selectedMenu == 0">
			<h1 class="text-center font-weight-light mb-4">{{ locale.general.title }}</h1>

			<div class="d-flex flex-column align-items-center">
				<div style="width: 280px; margin-right: -70px">
					<div class="mb-4" *ngIf="errorMessage.length > 0"><fab-message-bar [messageBarType]="errorMessageBarType">{{ errorMessage }}</fab-message-bar></div>
					<div class="mb-4" *ngIf="successMessage.length > 0"><fab-message-bar [messageBarType]="successMessageBarType">{{ successMessage }}</fab-message-bar></div>

					<!-- Avatar -->
					<img id="avatar-image" class="img mb-3 rounded" height="150" width="150" [alt]="locale.general.avatarAlt" [src]="dataService.user.Avatar"><br>

					<div class="d-flex">
						<fab-primary-button ngxFilePicker accept="image/png,image/jpeg" (filePick)="UpdateAvatar($event)" [disabled]="avatarLoading">{{ locale.general.uploadAvatar }}</fab-primary-button>
						<div style="margin-top: 8px; margin-left: 14px" *ngIf="avatarLoading"><fab-spinner [size]="spinnerSize"></fab-spinner></div>
					</div>

					<!-- Username -->
					<div class="mt-4 d-flex" style="font-size: 18px">
						<fab-text-field 
							id="username-text-field"
							[(value)]="username" 
							[label]="locale.general.usernameTextfieldLabel" 
							[placeholder]="locale.general.usernameTextfieldPlaceholder"
							[errorMessage]="usernameErrorMessage" 
							[styles]="textFieldStyles"
							type="text"
							autocomplete="username"
							(keydown)="UsernameTextFieldChanged($event)"></fab-text-field>

						<button 
							type="button" 
							class="btn btn-sm ml-2 icon-button"
							style="margin-top: 32px"
							[disabled]="usernameLoading"
							(click)="SaveUsername()"
							*ngIf="username != dataService.user.Username && username.length >= 2 && username.length <= 25">
							<fab-icon iconName="Save"></fab-icon>
						</button>

						<div style="margin-top: 39px; margin-left: 10px" *ngIf="usernameLoading"><fab-spinner [size]="spinnerSize"></fab-spinner></div>
					</div>

					<!-- Email -->
					<div class="mt-4 d-flex" style="font-size: 18px">
						<fab-text-field 
							id="email-text-field"
							[(value)]="email" 
							[label]="locale.general.emailTextfieldLabel" 
							[placeholder]="locale.general.emailTextfieldPlaceholder"
							[errorMessage]="emailErrorMessage" 
							[styles]="textFieldStyles"
							type="email"
							autocomplete="email"
							(keydown)="EmailTextFieldChanged($event)"></fab-text-field>

						<button
							type="button"
							class="btn btn-sm ml-2 icon-button"
							style="margin-top: 32px"
							[disabled]="emailLoading"
							(click)="SaveEmail()"
							*ngIf="email != dataService.user.Email && email != newEmail && email.length > 3 && email.includes('@')">
							<fab-icon iconName="Save"></fab-icon>
						</button>

						<div style="margin-top: 39px; margin-left: 10px" *ngIf="emailLoading"><fab-spinner [size]="spinnerSize"></fab-spinner></div>
					</div>

					<!-- Password -->
					<div class="mt-4 d-flex flex-column" style="font-size: 18px">
						<fab-text-field 
							id="password-text-field"
							[(value)]="password" 
							[label]="locale.general.passwordTextfieldLabel" 
							[placeholder]="locale.general.passwordTextfieldPlaceholder"
							[errorMessage]="passwordErrorMessage"
							[styles]="textFieldStyles"
							type="password"
							autocomplete="new-password"
							(keydown)="PasswordTextFieldChanged($event)">
						</fab-text-field>

						<fab-text-field 
							id="password-confirmation-text-field"
							[(value)]="passwordConfirmation" 
							[label]="locale.general.passwordConfirmationTextfieldLabel" 
							[placeholder]="locale.general.passwordConfirmationTextfieldPlaceholder" 
							className="mt-3" 
							[styles]="textFieldStyles"
							type="password"
							autocomplete="new-password"
							(keydown)="PasswordTextFieldChanged($event)"
							*ngIf="password.length >= 7 && password.length <= 25">
						</fab-text-field>

						<div class="d-flex">
							<fab-primary-button (click)="SavePassword()" *ngIf="password.length >= 7 && password.length <= 25" [disabled]="password != passwordConfirmation || passwordLoading" className="mt-3">{{ locale.general.save }}</fab-primary-button>
							<div style="margin-top: 24px; margin-left: 14px" *ngIf="passwordLoading"><fab-spinner [size]="spinnerSize"></fab-spinner></div>
						</div>
					</div>

					<div 
						style="border: 0.5px solid #dadada; width: 200px; margin: 20px 0px"
						*ngIf="!passwordConfirmationVisible"></div>

					<div class="d-flex" style="float: right; margin-right: 80px">
						<div style="margin-top: 8px; margin-right: 14px" *ngIf="sendDeleteAccountEmailLoading"><fab-spinner [size]="spinnerSize"></fab-spinner></div>
						<fab-primary-button 
							[styles]="deleteAccountButtonStyles"
							[disabled]="sendDeleteAccountEmailLoading" 
							*ngIf="!passwordConfirmationVisible"
							(click)="deleteAccountDialogVisible = true">{{ locale.general.deleteAccount }}</fab-primary-button>
					</div>
				</div>
			</div>
		</div>

		<!-- Plans -->
		<div class="navbar-margin pt-4 ms-motion-slideUpIn" style="background-color: white" *ngIf="selectedMenu == 1">
			<h1 class="text-center font-weight-light" [ngClass]="dataService.user.Plan == 0 ? 'mb-3' : 'mb-0'">{{ locale.plans.title }}</h1>

			<div class="mx-auto my-2" style="width: 250px" *ngIf="errorMessage.length > 0 || successMessage.length > 0">
				<div *ngIf="errorMessage.length > 0"><fab-message-bar [messageBarType]="errorMessageBarType">{{ errorMessage }}</fab-message-bar></div>
				<div *ngIf="successMessage.length > 0"><fab-message-bar [messageBarType]="successMessageBarType">{{ successMessage }}</fab-message-bar></div>
			</div>

			<p class="mt-3" style="margin-left: 10%; margin-right: 10%" *ngIf="!dataService.user.Confirmed">
				{{ locale.plans.confirmEmailText }}<br>
				<a href="#" (click)="SendVerificationEmail()">{{ locale.plans.confirmEmailLink }}</a>
			</p>

			<div class="d-flex flex-column align-items-center pb-4">
				<div style="width: 80%"><dav-website-pricing></dav-website-pricing></div>
			</div>
		</div>

		<!-- Apps -->
		<div class="navbar-margin pt-4 ms-motion-slideUpIn" style="background-color: white" *ngIf="selectedMenu == 2">
			<h1 class="text-center font-weight-light mb-4">{{ locale.apps.title }}</h1>

			<div class="mx-auto" style="width: 250px" *ngIf="errorMessage.length > 0 || successMessage.length > 0">
				<div *ngIf="errorMessage.length > 0"><fab-message-bar [messageBarType]="errorMessageBarType">{{ errorMessage }}</fab-message-bar></div>
				<div *ngIf="successMessage.length > 0"><fab-message-bar [messageBarType]="successMessageBarType">{{ successMessage }}</fab-message-bar></div>
			</div>
			
			<div class="d-flex flex-column align-items-center mb-4 mt-4">
				<div style="width: 40%; max-width: 552px">
					<mat-progress-bar [value]="usedStoragePercent"></mat-progress-bar>
					<p class="mt-2">{{ locale.apps.totalStorageUsed.replace("{0}", BytesToGigabytes(dataService.user.UsedStorage).toString()).replace("{1}", BytesToGigabytes(dataService.user.TotalStorage).toString()) }}</p>
				</div>
			</div>

			<div class="mx-auto mb-4 px-4" style="max-width: 600px">
				<mat-accordion *ngFor="let app of dataService.user.Apps; let i = index">
					<mat-expansion-panel>
						<mat-expansion-panel-header>
							<mat-panel-title style="font-size: 20px">{{ app.Name }}</mat-panel-title>
						</mat-expansion-panel-header>
	
						<div style="width: 60%; font-size: 16px" class="mx-auto mt-3">
							<mat-progress-bar [value]="appsUsedStoragePercent[i]"></mat-progress-bar>
							<p class="mt-2">{{ locale.apps.appStorageUsed.replace("{0}", BytesToGigabytes(app.UsedStorage).toString()) }}</p>
						</div>
	
						<div class="d-flex" style="float: right; margin-right: 20%">
							<div style="margin-top: 8px; margin-right: 14px" *ngIf="sendRemoveAppEmailLoading"><fab-spinner [size]="spinnerSize"></fab-spinner></div>
							<fab-primary-button [styles]="removeAppButtonStyles" [disabled]="sendRemoveAppEmailLoading" (click)="ShowRemoveAppDialog(app)">{{ locale.apps.removeApp }}</fab-primary-button>
						</div>
					</mat-expansion-panel>
				</mat-accordion>
			</div>
		</div>

		<!-- Provider -->
		<div class="navbar-margin pt-4 ms-motion-slideUpIn" style="background-color: white" *ngIf="selectedMenu == 3">
			<h1 class="text-center font-weight-light mb-4">{{ locale.provider.title }}</h1>
			<p class="text-center font-weight-light" style="font-size: 20px">{{ locale.provider.subTitle }}</p>

			<p class="text-center font-weight-light mt-3 mb-1" style="font-size: 20px">{{ locale.provider.supportedApps }}: </p>
			<div class="d-flex justify-content-center">
				<a class="text-center font-weight-light" style="color: black; font-size: 19px" href="https://pocketlib.dav-apps.tech" target="blank">PocketLib</a>
			</div>

			<div class="mt-5 d-flex flex-column align-items-center">
				<p class="text-center font-weight-light" [innerHTML]="locale.provider.setupExplanation"></p>
				<fab-primary-button>{{ locale.provider.startSetup }}</fab-primary-button>
			</div>
		</div>
	</mat-sidenav-content>
</mat-sidenav-container>

<fab-dialog 
	[hidden]="!deleteAccountDialogVisible" 
	[dialogContentProps]="deleteAccountDialogContent" 
	(onDismiss)="deleteAccountDialogVisible = false">
	<fab-dialog-footer>
		<fab-default-button (click)="deleteAccountDialogVisible = false">{{ locale.cancel }}</fab-default-button>
		<fab-primary-button [styles]="deleteAccountDialogButtonStyles" (click)="DeleteAccount()">{{ locale.general.deleteAccount }}</fab-primary-button>
	</fab-dialog-footer>
</fab-dialog>

<fab-dialog
	[hidden]="!removeAppDialogVisible"
	[dialogContentProps]="removeAppDialogContent"
	(onDismiss)="removeAppDialogVisible = false">
	<fab-dialog-footer>
		<fab-default-button (click)="removeAppDialogVisible = false">{{ locale.cancel }}</fab-default-button>
		<fab-primary-button [styles]="removeAppDialogButtonStyles" (click)="RemoveApp()">{{ locale.apps.removeApp }}</fab-primary-button>
	</fab-dialog-footer>
</fab-dialog>